{% extends "base/base.html" %}
{% block content %}
    <form action="" id="order_edit" method="post">{% csrf_token %}

<div class="form-group">
      <label for="organizationSelect">Order ID</label>
      <input class="form-control" id="unique_identifier_for_order" name="unique_identifier_for_order" type="text" placeholder="{{ order.unique_identifier_for_order}}" disabled>
    </div>




    <div class="form-group">
      <label for="organizationSelect">Organization</label>
      <select class="form-control" id="organization" name="organization"  onchange="onchangeOrganization(this)">
        <option value=""> -----</option>
      {% for organization in organizations %}
        <option value="{{ organization.id }}"  {% ifequal organization.id selected_organization %} selected="selected" {% endifequal %} > {{ organization.name }}</option>
      {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="branchSelect">Branch</label>
      <select class="form-control" id="branch" name="branch" onchange="onchangeBranch(this)">
        <option value=""> -----</option>
        {% for branch in branches %}
            <option value="{{ branch.id }}" {% ifequal branch.id selected_branch %} selected="selected" {% endifequal %}> {{ branch.name }}</option>
        {% endfor %}
      </select>
    </div>


    <div class="form-group">
      <label for="customerSelect">Customer</label>
      <select class="form-control" id="customer" name="customer">
        <option value=""> -----</option>
        {% for customer in customers %}
            <option value="{{ customer.id }}" {% ifequal customer.id selected_customer %} selected="selected" {% endifequal %}> {{ customer }}</option>
        {% endfor %}
      </select>
    </div>


    <div class="form-group">
      <label for="productSelect">Product</label>
      <select class="form-control" id="product" name="product">
        <option value=""> -----</option>
        {% for product in products %}
            <option value="{{ product.id }}" {% ifequal product.id selected_product %} selected="selected" {% endifequal %}> {{ product.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="comment">Comment:</label>
      <textarea class="form-control" rows="5" id="comments" name="comments">{{ order.comments }}</textarea>
    </div>


          <button type="button" class="btn btn-lg btn-danger" data-toggle="popover" title="Data Error" data-content="..." id="buttonPopover"onclick="checkData()">Save</button>

      <span id="helpBlock" class="help-block"></span>

<script type="text/javascript">



    function onchangeBranch(f_branch){
        var branch_val = f_branch.value;
        var branch_array = {{ branch_array|safe }};
        var f_customer = document.getElementById('customer');
        for(var key in branch_array) {
            if (key == branch_val) {

                f_customer.options.length = 1;
                {% for d_customer in customers %}
                    index = branch_array[key].indexOf( {{ d_customer.id }} )
                    if ( index != -1  ) {
                        createOption(f_customer, "{{ d_customer }}" , {{ d_customer.id }} );
                    }
                    
                {% endfor %}

                break;
            }
        }

    }

    function onchangeOrganization(f_org) {
        var org_val = f_org.value;
        var org_array = {{ organization_array|safe }};
        var f_branch = document.getElementById('branch');
        var f_customer = document.getElementById('customer');
        f_customer.options.length = 1;
        for(var key in org_array) {
            if (key == org_val) {

                f_branch.options.length = 1;
                {% for d_branch in branches %}
                    index = org_array[key].indexOf( {{ d_branch.id }} )
                    if ( index != -1  ) {
                        console.log("add here")
                        createOption(f_branch, "{{ d_branch.name }}" , {{ d_branch.id }} );
                    }
                    
                {% endfor %}

                break;
            }
        }
    }

    function createOption(ddl, text, value) {
        var opt = document.createElement('option');
        opt.value = value;
        opt.text = text;
        ddl.appendChild(opt);
    }

    function checkData() {
      var message = "";


      if (document.getElementById('customer').selectedIndex == ""){
        message = "Please select Customer";
      } else if (document.getElementById('branch').selectedIndex == ""){
        message = "Please select Branch";
      } else if (document.getElementById('product').selectedIndex == ""){
        message = "Please select Product";
      } else if (document.getElementById('organization').selectedIndex == ""){
        message = "Please select Organization";
      } else {
        document.getElementById("order_edit").submit();
      }
      var help = $('.help-block');
      help.attr('data-content', help.html()).text(message);
    }

</script>


</label>

    </form>
{% endblock %}